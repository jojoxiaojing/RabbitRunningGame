<html>
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <style>
        canvas {
            border: 1px solid black;
            width: 100%;
        }
    </style>
</head>
<body>
<h1>Player and Load Event</h1>
<canvas id="mycanvas" width="640" height="360" ></canvas>
<script>
  window.addEventListener('load', function(){

    //constants
    var GAME_WIDTH = 640;
    var GAME_HEIGHT = 360;

    var gameLive = true;

    //enemies
    var enemies = [
      {
        x: 100, //x coordinate
        y: 100, //y coordinate
        speedY: 2, //speed in Y
        w: 40, //width
        h: 40 //heght
      },
      {
        x: 260,
        y: 100,
        speedY: 2,
        w: 40,
        h: 40
      },
      {
        x: 380,
        y: 100,
        speedY: 3,
        w: 40,
        h: 40
      },
      {
        x: 450,
        y: 100,
        speedY: 2,
        w: 40,
        h: 40
      }
    ];

    //player object
    var player = {
      x: 10,
      y: 160,
      speedX: 2,
      w: 40,
      h: 40,
      isMoving: false
    }

    //the goal object
    var goal = {
      x: 580,
      y: 160,
      w: 50,
      h: 36
    }

    //grab the canvas and context
    var canvas = document.getElementById("mycanvas");
    var ctx = canvas.getContext("2d");

    //update the logic
    var update = function() {

      //check if you've won the game
      if(checkCollision(player, goal)) {
        //stop the game
        gameLive = false;

        alert('You\'ve won!');

        //reload page
        window.location = "";
      }

      //update player
      if(player.isMoving) {
        player.x += player.speedX;
      }

      //update enemies
      var i = 0;
      var n = enemies.length;

      enemies.forEach(function(element, index){
        element.y += element.speedY;

        //check for collision with player
        if(checkCollision(player, element)) {
          //stop the game
          gameLive = false;

          alert('Game Over');

          //reload
          window.location = "";
        }

        //check borders
        if(element.y <= 10) {
          element.y = 10;
          //element.speedY = element.speedY * -1;
          element.speedY *= -1;
        }
        else if(element.y >= GAME_HEIGHT - 50) {
          element.y = GAME_HEIGHT - 50;
          element.speedY *= -1;
        }
      });


    };

    //make the player move
    var movePlayer = function(){
      player.isMoving = true;
    };

    //make the player stop
    var stopPlayer = function(){
      player.isMoving = false;
    };

    //event listeners to move player
    canvas.addEventListener("mousedown", movePlayer);
    canvas.addEventListener("mouseup", stopPlayer);
    canvas.addEventListener('touchstart', movePlayer);
    canvas.addEventListener('touchend', stopPlayer);

    //show the game on the screen
    var draw = function() {
      //clear the canvas
      ctx.clearRect(0,0,GAME_WIDTH,GAME_HEIGHT);


      //draw player
      ctx.fillStyle = "#00FF00";
      ctx.fillRect(player.x, player.y, player.w, player.h);

      //draw enemies
      ctx.fillStyle = "#3333FF";
      enemies.forEach(function(element, index){
        ctx.fillRect(element.x, element.y, element.w, element.h);
      });

      //draw goal
      ctx.fillStyle = "rgb(128,128,0)";
      ctx.fillRect(goal.x, goal.y, goal.w, goal.h);

    };




    //check collision
    var checkCollision = function(rect1, rect2) {

      var pointInsideRec = function(cx, cy, rec) {
        return (cx >= rec.x && cx <= rec.x + rec.w)
            && (cy >= rec.y && cy <= rec.y + rec.h);
      };


      var checkLeftTop = pointInsideRec(rect1.x, rect1.y, rect2);
      var checkRightBottom = pointInsideRec(rect1.x + rect1.w, rect1.y + rect1.h, rect2);
      var checkLeftBottom = pointInsideRec(rect1.x, rect1.y + rect1.h, rect2);
      var checkRightTop = pointInsideRec(rect1.x + rect1.w, rect1.y, rect2);


      return checkLeftTop || checkRightBottom || checkLeftBottom || checkRightTop;
    };

    //gets executed multiple times per second
    var step = function() {

      update();
      draw();

      if(gameLive) {
        window.requestAnimationFrame(step);
      }

    };

    //initial kick
    step();
  });

</script>
</body>
</html>
